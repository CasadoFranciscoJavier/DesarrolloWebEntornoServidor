<?php

$repositorio_preguntas = [
    "Despliegue de Aplicaciones Web" => [
        [
            "pregunta" => "¿Qué herramienta se utiliza comúnmente para la virtualización de entornos de desarrollo?",
            "respuestas" => [
                "A" => "Docker",
                "B" => "Git",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué protocolo es esencial para la comunicación segura en un servidor web?",
            "respuestas" => [
                "A" => "HTTP",
                "B" => "HTTPS",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Cuál es el propósito principal de un servidor de aplicaciones como Apache Tomcat?",
            "respuestas" => [
                "A" => "Gestionar bases de datos",
                "B" => "Ejecutar aplicaciones web Java",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué comando de Linux se usa para mostrar los procesos en ejecución?",
            "respuestas" => [
                "A" => "ps", 
                "B" => "ls",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es un 'rollback' en el contexto de un despliegue?",
            "respuestas" => [
                "A" => "Revertir a una versión anterior del software",
                "B" => "Una actualización de la base de datos",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué significa CI/CD?",
            "respuestas" => [
                "A" => "Configuración Inicial / Conexión de Datos",
                "B" => "Integración Continua / Despliegue Continuo",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué tipo de servidor se encarga de servir páginas web estáticas?",
            "respuestas" => [
                "A" => "Servidor web (como Apache o Nginx)",
                "B" => "Servidor de aplicaciones",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Cuál de los siguientes no es un sistema de control de versiones?",
            "respuestas" => [
                "A" => "SVN",
                "B" => "FTP",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Para qué se utiliza la herramienta 'SSH'?",
            "respuestas" => [
                "A" => "Transferencia de archivos segura",
                "B" => "Acceso remoto seguro a un servidor",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué archivo de configuración es típico de un servidor web Apache?",
            "respuestas" => [
                "A" => "httpd.conf",
                "B" => "nginx.conf",
            ],
            "correcta" => "A"
        ],
    ],
    "Diseno de Interfaces Web" => [
        [
            "pregunta" => "¿Qué principio de diseño UI/UX se enfoca en la facilidad de uso?",
            "respuestas" => [
                "A" => "Usabilidad",
                "B" => "Estética",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es un 'wireframe' en diseño web?",
            "respuestas" => [
                "A" => "Un esquema visual básico de la interfaz",
                "B" => "Un prototipo interactivo completo",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué término describe el diseño que se adapta a diferentes tamaños de pantalla?",
            "respuestas" => [
                "A" => "Diseño estático",
                "B" => "Diseño responsivo",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué color evoca comúnmente sentimientos de calma y profesionalismo en diseño?",
            "respuestas" => [
                "A" => "Azul",
                "B" => "Rojo",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es la 'jerarquía visual'?",
            "respuestas" => [
                "A" => "La disposición de elementos para guiar la vista del usuario",
                "B" => "El orden en que los elementos aparecen en el código",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es un 'mockup' en diseño?",
            "respuestas" => [
                "A" => "Un diagrama de flujo",
                "B" => "Una representación estática de alta fidelidad de la interfaz",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué elemento mejora la legibilidad de un texto largo en una interfaz?",
            "respuestas" => [
                "A" => "Espacio en blanco y párrafos cortos",
                "B" => "Un tamaño de fuente muy pequeño",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es un 'persona' en UX?",
            "respuestas" => [
                "A" => "Un miembro del equipo de diseño",
                "B" => "Un arquetipo de usuario ficticio",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué principio de diseño sugiere mantener la consistencia en la interfaz?",
            "respuestas" => [
                "A" => "Uniformidad",
                "B" => "Innovación",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es la 'accesibilidad web'?",
            "respuestas" => [
                "A" => "La velocidad de carga de una página",
                "B" => "Diseñar para que todos los usuarios puedan interactuar con la web",
            ],
            "correcta" => "B"
        ],
    ],
    "WordPress" => [
        [
            "pregunta" => "¿Qué es un 'plugin' en WordPress?",
            "respuestas" => [
                "A" => "Un software que añade funcionalidades específicas",
                "B" => "Una plantilla de diseño",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué lenguaje de programación es la base de WordPress?",
            "respuestas" => [
                "A" => "JavaScript",
                "B" => "PHP",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué es un 'tema' en WordPress?",
            "respuestas" => [
                "A" => "El diseño visual y la presentación del sitio",
                "B" => "Una funcionalidad extra",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué diferencia hay entre una 'entrada' y una 'página' en WordPress?",
            "respuestas" => [
                "A" => "Las entradas son contenido dinámico (blog), las páginas son estáticas",
                "B" => "Las entradas son estáticas, las páginas son dinámicas",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Dónde se almacenan los contenidos de WordPress?",
            "respuestas" => [
                "A" => "En archivos de texto plano",
                "B" => "En una base de datos MySQL",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Cuál es el archivo principal que carga WordPress?",
            "respuestas" => [
                "A" => "index.php",
                "B" => "config.php",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es un 'widget' en WordPress?",
            "respuestas" => [
                "A" => "Un tipo de entrada especial",
                "B" => "Bloques de contenido que se pueden añadir a sidebars, footers, etc.",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Para qué sirve el archivo 'wp-config.php'?",
            "respuestas" => [
                "A" => "Configurar la conexión a la base de datos y otras opciones clave",
                "B" => "Gestionar usuarios y roles",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Cuál de los siguientes es un editor de bloques para WordPress?",
            "respuestas" => [
                "A" => "Visual Composer",
                "B" => "Gutenberg",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué se debe hacer regularmente para mantener seguro un sitio WordPress?",
            "respuestas" => [
                "A" => "Cambiar el tema cada mes",
                "B" => "Mantener plugins, temas y WordPress actualizados",
            ],
            "correcta" => "B"
        ],
    ],
    "Desarrollo Web Entorno Servidor" => [
        [
            "pregunta" => "¿Qué significa PHP?",
            "respuestas" => [
                "A" => "Personal Home Page",
                "B" => "PHP: Hypertext Preprocessor",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué superglobal de PHP se usa para acceder a datos enviados por POST?",
            "respuestas" => [
                "A" => "`$_POST`",
                "B" => "`$_GET`",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es una 'cookie' en el entorno servidor?",
            "respuestas" => [
                "A" => "Un archivo que almacena datos en el servidor",
                "B" => "Un pequeño fragmento de datos enviado por el servidor y almacenado en el navegador",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Cuál es la función principal de `include()` o `require()` en PHP?",
            "respuestas" => [
                "A" => "Insertar el contenido de otro archivo PHP",
                "B" => "Conectar a una base de datos",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué método HTTP se usa para solicitar datos al servidor?",
            "respuestas" => [
                "A" => "POST",
                "B" => "GET",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Para qué se utiliza una 'sesión' en PHP?",
            "respuestas" => [
                "A" => "Para almacenar datos persistentes en el cliente",
                "B" => "Para almacenar datos del usuario en el servidor durante su visita",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué significa 'MVC' en el desarrollo web?",
            "respuestas" => [
                "A" => "Múltiples Vistas y Controladores",
                "B" => "Modelo-Vista-Controlador",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué función de PHP se usa para conectar a una base de datos MySQL?",
            "respuestas" => [
                "A" => "`mysqli_connect()`",
                "B" => "`db_connect()`",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Cuál de los siguientes es un framework de PHP?",
            "respuestas" => [
                "A" => "React",
                "B" => "Laravel",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué tipo de ataque intenta inyectar código malicioso en una consulta SQL?",
            "respuestas" => [
                "A" => "Cross-Site Scripting (XSS)",
                "B" => "Inyección SQL",
            ],
            "correcta" => "B"
        ],
    ],
    "Desarrollo Web Entorno Cliente" => [
        [
            "pregunta" => "¿Qué lenguaje se usa para definir la estructura de una página web?",
            "respuestas" => [
                "A" => "HTML",
                "B" => "CSS",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué propiedad CSS se usa para cambiar el color de texto?",
            "respuestas" => [
                "A" => "background-color",
                "B" => "color",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué lenguaje de programación se ejecuta en el navegador del usuario?",
            "respuestas" => [
                "A" => "JavaScript",
                "B" => "PHP",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué selector CSS se usa para aplicar estilos a un elemento con un 'id' específico?",
            "respuestas" => [
                "A" => "#id",
                "B" => ".clase",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué es el DOM en JavaScript?",
            "respuestas" => [
                "A" => "Un tipo de base de datos",
                "B" => "La representación estructurada del documento HTML",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué etiqueta HTML se usa para enlazar una hoja de estilos externa?",
            "respuestas" => [
                "A" => "`",
                "B" => "`",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué framework de JavaScript es conocido por su enfoque en componentes?",
            "respuestas" => [
                "A" => "React",
                "B" => "jQuery",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Para qué sirve la propiedad CSS `display: flex;`?",
            "respuestas" => [
                "A" => "Para ocultar un elemento",
                "B" => "Para organizar elementos en una fila o columna de forma flexible",
            ],
            "correcta" => "B"
        ],
        [
            "pregunta" => "¿Qué evento de JavaScript se dispara cuando se hace clic en un elemento?",
            "respuestas" => [
                "A" => "`onclick`",
                "B" => "`onhover`",
            ],
            "correcta" => "A"
        ],
        [
            "pregunta" => "¿Qué etiqueta HTML es semánticamente correcta para el contenido principal de una página?",
            "respuestas" => [
                "A" => "`",
                "B" => "`
",
            ],
            "correcta" => "A"
        ],
    ],
];



// Función para mostrar alertas en JavaScript 
function alert($text)
{
    echo "<script> alert('$text') </script>";
}

function validarString($variablePOST, $minimo, $maximo) {
    $vacio = empty($_POST[$variablePOST]);
    $valido = false;
    if (!$vacio){
        $valido = (strlen($_POST[$variablePOST]) >= $minimo && strlen($_POST[$variablePOST]) <= $maximo);
    }
    if($vacio){
        alert("$variablePOST está vacío");
    } else if(!$valido){
        alert("$variablePOST fuera de rango (longitud entre $minimo y $maximo)");
    }
    return $valido;
}

function validarNumero($variablePOST, $minimo, $maximo){
    $vacio = empty($_POST[$variablePOST]);
    $valido = false;

    if (!$vacio){
        $esEntero = filter_var($_POST[$variablePOST], FILTER_VALIDATE_INT);

        if($esEntero){
            $valido = ( ($_POST[$variablePOST] >= $minimo )
                     && ($_POST[$variablePOST] <= $maximo ) );
        }
    }
    
    if($vacio){
        alert("$variablePOST está vacío");
    } else if(!$esEntero){
        alert("$variablePOST debe ser un número entero");
    } else if(!$valido){
        alert("$variablePOST fuera de rango (entre $minimo y $maximo)");
    }

    return $valido;
}

function validarSeleccion($variablePOST)
{
    $vacio = empty($_POST[$variablePOST]) || $_POST[$variablePOST] == "Nada";
    if ($vacio) {
        alert("Debes seleccionar una asignatura");
    }
    return !$vacio;
}

$todoValido = false;
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $todoValido = validarString("nombre", 1, 20)
        && validarString("apellidos", 1, 20)
        && validarSeleccion("asignatura")
        && validarNumero("preguntas", 1, 5);

    if ($todoValido) {
        $nombre = htmlspecialchars($_POST["nombre"]);
        $apellidos = htmlspecialchars($_POST["apellidos"]);
        $asignatura_seleccionada = htmlspecialchars($_POST["asignatura"]);
        $cantidad_preguntas = intval($_POST["preguntas"]);

        $preguntas_asignatura = $repositorio_preguntas[$asignatura_seleccionada];
        $indices_aleatorios = array_rand($preguntas_asignatura, $cantidad_preguntas);
        if (!is_array($indices_aleatorios)) {
            $indices_aleatorios = [$indices_aleatorios];
        }
        $preguntas_para_test = [];
        foreach ($indices_aleatorios as $indice) {
            $preguntas_para_test[] = $preguntas_asignatura[$indice];
        }
?>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test de <?php echo $asignatura_seleccionada; ?></title>
</head>
<body>
    <div class="contenedor-test">
        <h1>Test de <?php echo $asignatura_seleccionada; ?></h1>
        <p class="info-usuario">
            ¡Hola, <strong><?php echo $nombre . " " . $apellidos; ?></strong>!
            Responde las siguientes <strong><?php echo $cantidad_preguntas; ?> preguntas</strong>
            de la asignatura "<?php echo $asignatura_seleccionada; ?>".
        </p>
        <form action="procesarTest.php" method="POST">
            <input type="hidden" name="nombre" value="<?php echo $nombre; ?>">
            <input type="hidden" name="apellido" value="<?php echo $apellidos; ?>">
            <input type="hidden" name="asignatura" value="<?php echo $asignatura_seleccionada; ?>">
            <input type="hidden" name="cantidad_preguntas_test" value="<?php echo $cantidad_preguntas; ?>">
            <?php
            foreach ($preguntas_para_test as $indice_pregunta => $pregunta_actual) {
                echo "<div class='pregunta-item'>";
                echo "<p class='pregunta-texto'>" . ($indice_pregunta + 1) . ". " . $pregunta_actual["pregunta"] . "</p>";
                echo "<input type='hidden' name='pregunta_" . $indice_pregunta . "_texto' value='" . htmlspecialchars($pregunta_actual["pregunta"]) . "'>";
                echo "<input type='hidden' name='pregunta_" . $indice_pregunta . "_correcta' value='" . $pregunta_actual["correcta"] . "'>";
                foreach ($pregunta_actual["respuestas"] as $opcion => $texto_respuesta) {
                    echo "<label>";
                    echo "<input type='radio' name='respuesta_pregunta_" . $indice_pregunta . "' value='" . $opcion . "' required>";
                    echo $opcion . ") " . htmlspecialchars($texto_respuesta);
                    echo "</label>";
                }
                echo "</div>";
            }
            ?>
            <button type="submit">Finalizar Test</button>
        </form>
    </div>
    <style>
        body {
            background: #f3f6f9;
            font-family: 'Segoe UI', Arial, sans-serif;
            color: #333;
        }
        .contenedor-test {
            background: #fff;
            max-width: 600px;
            margin: 40px auto;
            padding: 32px 28px 24px 28px;
            border-radius: 14px;
            box-shadow: 0 4px 24px rgba(60, 80, 120, 0.08);
            border: 1px solid #e3e8ee;
        }
        h1, h2 {
            text-align: center;
            color: #4a6fa5;
            margin-bottom: 24px;
            font-weight: 600;
        }
        h2 {
            font-size: 1.5em;
            margin-top: 30px;
        }
        p.info-usuario {
            text-align: center;
            font-size: 1.1em;
            margin-bottom: 20px;
            color: #555;
        }
        .pregunta-item {
            background-color: #f7fafd;
            border: 1px solid #e3e8ee;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 25px;
        }
        .pregunta-item p.pregunta-texto {
            font-size: 1.15em;
            font-weight: 600;
            color: #4a6fa5;
            margin-bottom: 12px;
        }
        .pregunta-item label {
            display: block;
            margin-bottom: 8px;
            font-size: 1em;
            cursor: pointer;
            padding: 5px 0;
            color: #333;
            transition: color 0.2s;
        }
        .pregunta-item label:hover {
            color: #7ea1c4;
        }
        .pregunta-item input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.1);
            accent-color: #4a6fa5;
        }
        button[type="submit"] {
            display: block;
            margin: 30px auto 0;
            background: #7ea1c4;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background 0.2s;
        }
        button[type="submit"]:hover {
            background: #4a6fa5;
        }
    </style>
</body>
</html>
<?php
    }
} else {
    header("Location: tests.html");
    exit();
}
?>