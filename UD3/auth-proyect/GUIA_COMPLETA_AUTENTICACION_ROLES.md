# ğŸ“š GUÃA COMPLETA: Sistema de AutenticaciÃ³n y Roles en Laravel

## ğŸ¯ IntroducciÃ³n

Esta es la guÃ­a definitiva para entender paso a paso cÃ³mo funciona el sistema de autenticaciÃ³n y roles en Laravel. EstÃ¡ diseÃ±ada para que cualquier persona, incluso sin experiencia previa, pueda entender el flujo completo de la aplicaciÃ³n.

---

## ğŸ“‹ Tabla de Contenidos

1. [Arquitectura General](#arquitectura-general)
2. [Base de Datos](#base-de-datos)
3. [Flujo de Registro de Usuario](#flujo-de-registro-de-usuario)
4. [Flujo de Inicio de SesiÃ³n](#flujo-de-inicio-de-sesiÃ³n)
5. [Sistema de Roles y Middleware](#sistema-de-roles-y-middleware)
6. [Flujo Completo: Usuario Accediendo al Panel Admin](#flujo-completo-usuario-accediendo-al-panel-admin)
7. [Archivos Clave y su FunciÃ³n](#archivos-clave-y-su-funciÃ³n)
8. [Debugging: CÃ³mo Rastrear Problemas](#debugging-cÃ³mo-rastrear-problemas)
9. [Preguntas Frecuentes](#preguntas-frecuentes)

---

## ğŸ—ï¸ Arquitectura General

### Â¿CÃ³mo estÃ¡ organizado Laravel?

Laravel sigue el patrÃ³n **MVC (Modelo-Vista-Controlador)**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         NAVEGADOR                            â”‚
â”‚  (El usuario hace clic en botones, envÃ­a formularios, etc.) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          RUTAS                               â”‚
â”‚              (routes/web.php)                                â”‚
â”‚  Define quÃ© URL lleva a quÃ© acciÃ³n                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MIDDLEWARE                             â”‚
â”‚  (Filtros que verifican condiciones antes de procesar)      â”‚
â”‚  - Â¿El usuario estÃ¡ autenticado?                            â”‚
â”‚  - Â¿Tiene el rol correcto?                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTROLADOR                             â”‚
â”‚  (Maneja la lÃ³gica de negocio)                              â”‚
â”‚  - Valida datos                                              â”‚
â”‚  - InteractÃºa con la base de datos                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MODELO                                â”‚
â”‚  (Representa una tabla de la base de datos)                 â”‚
â”‚  - User (tabla users)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BASE DE DATOS                             â”‚
â”‚  (MySQL - Almacena los datos)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        VISTA                                 â”‚
â”‚  (archivo .blade.php - HTML que ve el usuario)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Base de Datos

### Estructura de la Tabla `users`

```sql
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    email_verified_at TIMESTAMP NULL,
    password VARCHAR(255) NOT NULL,
    remember_token VARCHAR(100) NULL,
    role VARCHAR(255) DEFAULT 'user',  -- â† COLUMNA AÃ‘ADIDA PARA ROLES
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL
);
```

### Â¿CÃ³mo se creÃ³ esta tabla?

#### 1. **MigraciÃ³n Original** (`0001_01_01_000000_create_users_table.php`)

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();                    // Crea columna 'id' AUTO_INCREMENT
            $table->string('name');          // Crea columna 'name' VARCHAR(255)
            $table->string('email')->unique(); // Crea columna 'email' UNIQUE
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');      // Crea columna 'password' VARCHAR(255)
            $table->rememberToken();         // Crea columna 'remember_token'
            $table->timestamps();            // Crea 'created_at' y 'updated_at'
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('users'); // Elimina la tabla si hacemos rollback
    }
};
```

**Â¿QuÃ© hace esto?**
- `Schema::create('users', ...)`: Crea una nueva tabla llamada `users`
- `$table->id()`: AÃ±ade una columna `id` que es PRIMARY KEY y AUTO_INCREMENT
- `$table->string('email')->unique()`: AÃ±ade columna email que debe ser Ãºnica
- `$table->timestamps()`: AÃ±ade `created_at` y `updated_at` automÃ¡ticamente

#### 2. **MigraciÃ³n Adicional** (`2025_12_04_090711_add_rol_to_users_table.php`)

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->string('role')->default('user'); // AÃ±ade columna 'role'
        });
    }

    public function down(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->dropColumn('role'); // Elimina columna 'role'
        });
    }
};
```

**Â¿QuÃ© hace esto?**
- `Schema::table('users', ...)`: Modifica la tabla `users` existente (NO la crea)
- `$table->string('role')->default('user')`: AÃ±ade una nueva columna llamada `role` con valor por defecto `'user'`
- **Por defecto**: Cuando se registra un usuario nuevo, tendrÃ¡ `role = 'user'`

---

## ğŸ“ Flujo de Registro de Usuario

### Paso a Paso: Â¿QuÃ© pasa cuando un usuario se registra?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 1: Usuario visita /register                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel busca en routes/web.php:                                â”‚
â”‚  Auth::routes();  â† Esto incluye la ruta GET /register          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel muestra la vista:                                       â”‚
â”‚  resources/views/auth/register.blade.php                         â”‚
â”‚  (Un formulario con campos: name, email, password)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 2: Usuario llena el formulario y hace clic en "Register"  â”‚
â”‚  El formulario envÃ­a POST a /register                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel busca en routes/web.php:                                â”‚
â”‚  Auth::routes();  â† Esto incluye la ruta POST /register         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel ejecuta:                                                â”‚
â”‚  App\Http\Controllers\Auth\RegisterController@register          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RegisterController::register() (mÃ©todo del trait)               â”‚
â”‚  1. Llama a validator($data)                                     â”‚
â”‚  2. Llama a create($data)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 3: validator($data) valida los datos                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ protected function validator(array $data)                  â”‚ â”‚
â”‚  â”‚ {                                                          â”‚ â”‚
â”‚  â”‚     return Validator::make($data, [                        â”‚ â”‚
â”‚  â”‚         'name' => ['required', 'string', 'max:255'],       â”‚ â”‚
â”‚  â”‚         'email' => ['required', 'string', 'email',         â”‚ â”‚
â”‚  â”‚                     'max:255', 'unique:users'],            â”‚ â”‚
â”‚  â”‚         'password' => ['required', 'string', 'min:8',      â”‚ â”‚
â”‚  â”‚                        'confirmed'],                       â”‚ â”‚
â”‚  â”‚     ]);                                                    â”‚ â”‚
â”‚  â”‚ }                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  Verifica:                                                       â”‚
â”‚  âœ“ Nombre es obligatorio, mÃ¡ximo 255 caracteres                 â”‚
â”‚  âœ“ Email es vÃ¡lido, Ãºnico en la tabla users                     â”‚
â”‚  âœ“ ContraseÃ±a mÃ­nimo 8 caracteres y confirmada                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 4: create($data) crea el usuario en la base de datos      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ protected function create(array $data)                     â”‚ â”‚
â”‚  â”‚ {                                                          â”‚ â”‚
â”‚  â”‚     return User::create([                                  â”‚ â”‚
â”‚  â”‚         'name' => $data['name'],                           â”‚ â”‚
â”‚  â”‚         'email' => $data['email'],                         â”‚ â”‚
â”‚  â”‚         'password' => Hash::make($data['password']),       â”‚ â”‚
â”‚  â”‚     ]);                                                    â”‚ â”‚
â”‚  â”‚ }                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  IMPORTANTE:                                                     â”‚
â”‚  - NO se establece 'role' aquÃ­                                   â”‚
â”‚  - La base de datos usa el valor por defecto: 'user'            â”‚
â”‚  - Hash::make() encripta la contraseÃ±a                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  En la base de datos se ejecuta algo como:                       â”‚
â”‚  INSERT INTO users (name, email, password, role, created_at)     â”‚
â”‚  VALUES ('Juan', 'juan@email.com', '$2y$10$...', 'user', NOW())  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 5: Usuario es autenticado automÃ¡ticamente                 â”‚
â”‚  Laravel crea una sesiÃ³n y lo redirige a /home                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Â¿CÃ³mo crear un usuario admin?

**OpciÃ³n 1: Directamente en la base de datos**
```sql
UPDATE users SET role = 'admin' WHERE email = 'admin@example.com';
```

**OpciÃ³n 2: Con Laravel Tinker**
```bash
php artisan tinker
>>> $user = User::find(1);
>>> $user->role = 'admin';
>>> $user->save();
```

**OpciÃ³n 3: Modificar RegisterController**
```php
// En RegisterController::create()
protected function create(array $data)
{
    return User::create([
        'name' => $data['name'],
        'email' => $data['email'],
        'password' => Hash::make($data['password']),
        'role' => 'admin', // â† AÃ±adir esta lÃ­nea
    ]);
}
```

---

## ğŸ” Flujo de Inicio de SesiÃ³n

### Paso a Paso: Â¿QuÃ© pasa cuando un usuario inicia sesiÃ³n?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 1: Usuario visita /login                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel muestra: resources/views/auth/login.blade.php           â”‚
â”‚  (Formulario con email y password)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 2: Usuario ingresa credenciales y envÃ­a POST /login       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel ejecuta:                                                â”‚
â”‚  App\Http\Controllers\Auth\LoginController                       â”‚
â”‚  (que usa el trait AuthenticatesUsers)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 3: Laravel verifica las credenciales                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ SELECT * FROM users WHERE email = 'user@example.com'       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Hash::check($password_ingresado, $password_en_bd)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 4: Si las credenciales son correctas:                      â”‚
â”‚  - Laravel crea una SESIÃ“N                                       â”‚
â”‚  - Guarda el ID del usuario en la sesiÃ³n                         â”‚
â”‚  - Crea una cookie en el navegador                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 5: Redirige al usuario a /home                             â”‚
â”‚  (definido en LoginController::$redirectTo)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Â¿QuÃ© es una sesiÃ³n?

Cuando un usuario inicia sesiÃ³n, Laravel:

1. **Crea un registro en la tabla `sessions`**:
```sql
INSERT INTO sessions (id, user_id, ip_address, user_agent, payload, last_activity)
VALUES (
    'abc123...',  -- ID Ãºnico de sesiÃ³n
    5,            -- ID del usuario autenticado
    '127.0.0.1',  -- IP del usuario
    'Mozilla/5.0...', -- Navegador
    '...',        -- Datos encriptados
    1701234567    -- Timestamp
);
```

2. **EnvÃ­a una cookie al navegador**:
```
laravel_session=abc123...
```

3. **En cada peticiÃ³n siguiente**:
   - El navegador envÃ­a la cookie
   - Laravel busca la sesiÃ³n en la base de datos
   - Laravel sabe quiÃ©n es el usuario

---

## ğŸ›¡ï¸ Sistema de Roles y Middleware

### Â¿QuÃ© es un Middleware?

Un **middleware** es un **filtro** que se ejecuta **ANTES** de que una peticiÃ³n llegue al controlador.

**AnalogÃ­a**: Es como un guardia de seguridad en la entrada de un edificio que verifica tu identificaciÃ³n antes de dejarte pasar.

### RoleMiddleware: CÃ³digo Explicado LÃ­nea por LÃ­nea

```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;
use Illuminate\Support\Facades\Auth;

class RoleMiddleware
{
    /**
     * Este mÃ©todo se ejecuta ANTES de que la peticiÃ³n llegue al controlador
     *
     * @param Request $request - La peticiÃ³n HTTP (GET, POST, etc.)
     * @param Closure $next - La siguiente acciÃ³n en la cadena
     * @param string $role - El rol requerido (ej: 'admin', 'user')
     */
    public function handle(Request $request, Closure $next, string $role): Response
    {
        // PASO 1: Verificar si el usuario estÃ¡ autenticado
        if (Auth::check()) {
            // Auth::check() retorna true si hay un usuario logueado

            // PASO 2: Verificar si el usuario tiene el rol correcto
            if (Auth::user()->rol == $role) {
                // Auth::user() obtiene el usuario actual de la sesiÃ³n
                // Auth::user()->rol obtiene el valor de la columna 'rol'

                // Si el rol coincide, permitir el acceso
                return $next($request);
            }
        }

        // PASO 3: Si no estÃ¡ autenticado O no tiene el rol correcto
        // Redirigir a la pÃ¡gina principal
        return redirect('/');
    }
}
```

### Flujo Visual del Middleware

```
Usuario intenta acceder a /panel-admin
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ruta en web.php:                        â”‚
â”‚  Route::get('/panel-admin', ...)        â”‚
â”‚       ->middleware('role:admin');        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel ejecuta RoleMiddleware         â”‚
â”‚  con parÃ¡metro $role = 'admin'          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
     Â¿Usuario logueado?
             â”‚
       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
       â”‚           â”‚
      SÃ          NO
       â”‚           â”‚
       â–¼           â–¼
   Â¿rol == 'admin'?  redirect('/')
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â”‚       â”‚
  SÃ      NO
   â”‚       â”‚
   â–¼       â–¼
Continuar  redirect('/')
   â”‚
   â–¼
Muestra panel-admin.blade.php
```

### Registrar el Middleware en Laravel

**Archivo**: `bootstrap/app.php`

```php
<?php

use Illuminate\Foundation\Application;
use Illuminate\Foundation\Configuration\Middleware;

return Application::configure(basePath: dirname(__DIR__))
    ->withMiddleware(function (Middleware $middleware): void {
        // Registrar el alias 'role' para RoleMiddleware
        $middleware->alias([
            'role' => \App\Http\Middleware\RoleMiddleware::class,
        ]);

        // Ahora podemos usar ->middleware('role:admin') en las rutas
    })
    ->create();
```

**Â¿QuÃ© hace esto?**
- Crea un alias `'role'` que apunta a `RoleMiddleware`
- Permite usar `->middleware('role:admin')` en vez de escribir la ruta completa
- Similar a crear un atajo o nickname

---

## ğŸš€ Flujo Completo: Usuario Accediendo al Panel Admin

### Escenario: Usuario admin intenta acceder a `/panel-admin`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 1: Usuario escribe en el navegador:                       â”‚
â”‚  http://127.0.0.1:8000/panel-admin                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 2: El navegador envÃ­a una peticiÃ³n GET                    â”‚
â”‚  GET /panel-admin HTTP/1.1                                       â”‚
â”‚  Cookie: laravel_session=abc123...                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 3: Laravel busca la ruta en routes/web.php                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Route::get('/panel-admin', function () {                  â”‚ â”‚
â”‚  â”‚     return view('panel-admin');                           â”‚ â”‚
â”‚  â”‚ })->middleware('role:admin');                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  Encuentra la ruta y ve que tiene middleware 'role:admin'       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 4: Laravel ejecuta el middleware RoleMiddleware           â”‚
â”‚  con el parÃ¡metro $role = 'admin'                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 5: RoleMiddleware verifica la sesiÃ³n                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ // Obtiene la cookie laravel_session                      â”‚ â”‚
â”‚  â”‚ // Busca en la tabla sessions:                            â”‚ â”‚
â”‚  â”‚ SELECT * FROM sessions WHERE id = 'abc123...'             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ // Resultado:                                             â”‚ â”‚
â”‚  â”‚ {                                                         â”‚ â”‚
â”‚  â”‚   "id": "abc123...",                                      â”‚ â”‚
â”‚  â”‚   "user_id": 5,  â† El usuario con ID 5 estÃ¡ logueado     â”‚ â”‚
â”‚  â”‚   ...                                                     â”‚ â”‚
â”‚  â”‚ }                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 6: Laravel carga el usuario de la base de datos           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ SELECT * FROM users WHERE id = 5                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ // Resultado:                                             â”‚ â”‚
â”‚  â”‚ {                                                         â”‚ â”‚
â”‚  â”‚   "id": 5,                                                â”‚ â”‚
â”‚  â”‚   "name": "Admin User",                                   â”‚ â”‚
â”‚  â”‚   "email": "admin@example.com",                           â”‚ â”‚
â”‚  â”‚   "role": "admin",  â† Â¡El usuario tiene rol admin!       â”‚ â”‚
â”‚  â”‚   ...                                                     â”‚ â”‚
â”‚  â”‚ }                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 7: RoleMiddleware compara los roles                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ if (Auth::user()->rol == $role) {                         â”‚ â”‚
â”‚  â”‚     // "admin" == "admin" â†’ TRUE âœ“                        â”‚ â”‚
â”‚  â”‚     return $next($request); // Continuar                  â”‚ â”‚
â”‚  â”‚ }                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  El rol coincide, se permite el acceso                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 8: Laravel ejecuta la funciÃ³n de la ruta                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ return view('panel-admin');                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 9: Laravel busca la vista                                 â”‚
â”‚  resources/views/panel-admin.blade.php                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 10: Laravel procesa el archivo Blade                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ @extends('layouts.app')                                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ @section('content')                                       â”‚ â”‚
â”‚  â”‚ <h1>ERES EL P*** ADMIN!</h1>                              â”‚ â”‚
â”‚  â”‚ @endsection                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  Blade compila esto en HTML puro                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 11: Laravel envÃ­a la respuesta HTML al navegador          â”‚
â”‚  HTTP/1.1 200 OK                                                 â”‚
â”‚  Content-Type: text/html                                         â”‚
â”‚                                                                  â”‚
â”‚  <html>                                                          â”‚
â”‚    <body>                                                        â”‚
â”‚      <h1>ERES EL P*** ADMIN!</h1>                                â”‚
â”‚    </body>                                                       â”‚
â”‚  </html>                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Â¿QuÃ© pasa si el usuario NO es admin?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usuario con role = 'user' intenta acceder a /panel-admin       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RoleMiddleware compara:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ if (Auth::user()->rol == $role) {                         â”‚ â”‚
â”‚  â”‚     // "user" == "admin" â†’ FALSE âœ—                        â”‚ â”‚
â”‚  â”‚ }                                                         â”‚ â”‚
â”‚  â”‚ return redirect('/'); // Redirigir a home                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel envÃ­a una redirecciÃ³n:                                  â”‚
â”‚  HTTP/1.1 302 Found                                              â”‚
â”‚  Location: http://127.0.0.1:8000/                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  El navegador automÃ¡ticamente visita http://127.0.0.1:8000/     â”‚
â”‚  El usuario ve la pÃ¡gina de inicio, NO el panel admin           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Archivos Clave y su FunciÃ³n

### 1. **routes/web.php**

**PropÃ³sito**: Define todas las URL de la aplicaciÃ³n

```php
<?php

use Illuminate\Support\Facades\Route;

// Ruta raÃ­z - Requiere autenticaciÃ³n
Route::get('/', function () {
    return view('home');
})->middleware('auth');
// Si el usuario NO estÃ¡ logueado, lo redirige a /login

// Panel de administrador - Requiere rol 'admin'
Route::get('/panel-admin', function () {
    return view('panel-admin');
})->middleware('role:admin');
// Primero verifica autenticaciÃ³n (implÃ­cito)
// Luego verifica que role == 'admin'

// Rutas de autenticaciÃ³n (login, register, logout, etc.)
Auth::routes();
// Esto crea automÃ¡ticamente:
// - GET /login
// - POST /login
// - GET /register
// - POST /register
// - POST /logout
// - GET /password/reset
// - POST /password/email
// - etc.

// Ruta al home despuÃ©s de login
Route::get('/home', [App\Http\Controllers\HomeController::class, 'index'])
    ->name('home');
```

### 2. **app/Models/User.php**

**PropÃ³sito**: Representa la tabla `users` en la base de datos

```php
<?php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
    use Notifiable;

    /**
     * Atributos que se pueden asignar en masa
     * Permite hacer: User::create(['name' => ..., 'email' => ...])
     */
    protected $fillable = [
        'name',
        'email',
        'password',
        'rol',  // â† IMPORTANTE: Permite asignar el rol
    ];

    /**
     * Atributos que se ocultan al convertir a JSON
     * Por seguridad, nunca mostramos la contraseÃ±a
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * ConversiÃ³n de tipos de datos
     * - email_verified_at se convierte a Carbon (fecha)
     * - password se hashea automÃ¡ticamente
     */
    protected function casts(): array
    {
        return [
            'email_verified_at' => 'datetime',
            'password' => 'hashed',
        ];
    }
}
```

**Ejemplo de uso**:

```php
// Crear un nuevo usuario
$user = User::create([
    'name' => 'Juan PÃ©rez',
    'email' => 'juan@example.com',
    'password' => bcrypt('secreto123'),
    'rol' => 'admin',
]);

// Buscar un usuario por email
$user = User::where('email', 'juan@example.com')->first();

// Obtener todos los admins
$admins = User::where('rol', 'admin')->get();

// Actualizar el rol de un usuario
$user = User::find(5);
$user->rol = 'admin';
$user->save();
```

### 3. **app/Http/Controllers/Auth/RegisterController.php**

**PropÃ³sito**: Maneja el registro de nuevos usuarios

```php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Validator;

class RegisterController extends Controller
{
    /**
     * A dÃ³nde redirigir despuÃ©s de registrarse
     */
    protected $redirectTo = '/home';

    /**
     * Solo usuarios NO autenticados pueden registrarse
     */
    public function __construct()
    {
        $this->middleware('guest');
    }

    /**
     * Valida los datos del formulario de registro
     */
    protected function validator(array $data)
    {
        return Validator::make($data, [
            'name' => ['required', 'string', 'max:255'],
            'email' => [
                'required',
                'string',
                'email',
                'max:255',
                'unique:users'  // El email debe ser Ãºnico
            ],
            'password' => [
                'required',
                'string',
                'min:8',      // MÃ­nimo 8 caracteres
                'confirmed'   // Debe coincidir con password_confirmation
            ],
        ]);
    }

    /**
     * Crea un nuevo usuario en la base de datos
     */
    protected function create(array $data)
    {
        return User::create([
            'name' => $data['name'],
            'email' => $data['email'],
            'password' => Hash::make($data['password']), // Encripta la contraseÃ±a
            // 'rol' no se especifica, usa el default 'user'
        ]);
    }
}
```

**Flujo de validaciÃ³n**:

```php
// Datos del formulario
$data = [
    'name' => 'Juan',
    'email' => 'juan@example.com',
    'password' => 'secreto123',
    'password_confirmation' => 'secreto123',
];

// Laravel valida automÃ¡ticamente:
validator($data)->validate();

// Si pasa validaciÃ³n, crea el usuario:
create($data);

// Si falla validaciÃ³n, redirige back() con errores
```

### 4. **app/Http/Controllers/Auth/LoginController.php**

**PropÃ³sito**: Maneja el inicio de sesiÃ³n

```php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Foundation\Auth\AuthenticatesUsers;

class LoginController extends Controller
{
    use AuthenticatesUsers; // Trait con toda la lÃ³gica de login

    /**
     * A dÃ³nde redirigir despuÃ©s del login
     */
    protected $redirectTo = '/home';

    /**
     * ConfiguraciÃ³n de middleware
     */
    public function __construct()
    {
        // Solo usuarios NO autenticados pueden ver /login
        $this->middleware('guest')->except('logout');

        // Solo usuarios autenticados pueden hacer logout
        $this->middleware('auth')->only('logout');
    }
}
```

**El trait `AuthenticatesUsers` hace**:

1. Muestra el formulario de login
2. Valida las credenciales
3. Verifica el hash de la contraseÃ±a
4. Crea la sesiÃ³n
5. Redirige al usuario

### 5. **app/Http/Middleware/RoleMiddleware.php**

Ya explicado en detalle anteriormente. **FunciÃ³n**: Verificar que el usuario tenga un rol especÃ­fico.

### 6. **bootstrap/app.php**

**PropÃ³sito**: ConfiguraciÃ³n principal de Laravel

```php
<?php

use Illuminate\Foundation\Application;
use Illuminate\Foundation\Configuration\Middleware;

return Application::configure(basePath: dirname(__DIR__))
    ->withRouting(
        web: __DIR__.'/../routes/web.php',     // Rutas web
        commands: __DIR__.'/../routes/console.php', // Comandos artisan
        health: '/up',  // Ruta para healthcheck
    )
    ->withMiddleware(function (Middleware $middleware): void {
        // Registrar alias de middleware
        $middleware->alias([
            'role' => \App\Http\Middleware\RoleMiddleware::class,
        ]);
    })
    ->create();
```

### 7. **resources/views/layouts/app.blade.php**

**PropÃ³sito**: Layout principal de la aplicaciÃ³n

```blade
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>@yield('title', 'Mi App')</title>
    <link href="{{ asset('css/app.css') }}" rel="stylesheet">
</head>
<body>
    <nav>
        @guest
            <!-- Usuario NO autenticado -->
            <a href="{{ route('login') }}">Login</a>
            <a href="{{ route('register') }}">Register</a>
        @else
            <!-- Usuario autenticado -->
            <span>Hola, {{ Auth::user()->name }}</span>

            @if(Auth::user()->rol == 'admin')
                <a href="/panel-admin">Panel Admin</a>
            @endif

            <form method="POST" action="{{ route('logout') }}">
                @csrf
                <button type="submit">Logout</button>
            </form>
        @endguest
    </nav>

    <main>
        @yield('content')
    </main>
</body>
</html>
```

**Directivas Blade**:

- `@yield('content')`: Define una secciÃ³n que serÃ¡ reemplazada
- `@guest`: Solo se muestra si el usuario NO estÃ¡ autenticado
- `@auth`: Solo se muestra si el usuario estÃ¡ autenticado
- `@if()`: Condicional normal
- `{{ }}`: Imprime una variable (escapado por seguridad)
- `{!! !!}`: Imprime HTML sin escapar (peligroso)

### 8. **resources/views/panel-admin.blade.php**

```blade
@extends('layouts.app')

@section('content')
<div class="container">
    <h1>ERES EL P*** ADMIN!</h1>

    <p>Bienvenido, {{ Auth::user()->name }}</p>

    <h2>Panel de AdministraciÃ³n</h2>

    <!-- AquÃ­ puedes agregar contenido solo para admins -->
    <ul>
        <li><a href="/usuarios">Gestionar Usuarios</a></li>
        <li><a href="/reportes">Ver Reportes</a></li>
        <li><a href="/configuracion">ConfiguraciÃ³n</a></li>
    </ul>
</div>
@endsection
```

---

## ğŸ› Debugging: CÃ³mo Rastrear Problemas

### Problema 1: "No puedo acceder a /panel-admin"

**Checklist de depuraciÃ³n**:

1. **Â¿EstÃ¡s logueado?**
```blade
<!-- Agregar en cualquier vista -->
@auth
    <p>Logueado como: {{ Auth::user()->email }}</p>
    <p>Rol: {{ Auth::user()->rol }}</p>
@else
    <p>NO estÃ¡s logueado</p>
@endauth
```

2. **Verificar en la base de datos**:
```sql
SELECT id, name, email, role FROM users WHERE email = 'tu@email.com';
```

3. **Verificar el middleware estÃ¡ registrado**:
```bash
php artisan route:list
```
Busca `/panel-admin` y verifica que tenga `role:admin` en la columna Middleware.

4. **Agregar logs en RoleMiddleware**:
```php
public function handle(Request $request, Closure $next, string $role): Response
{
    // Debug: Ver quÃ© estÃ¡ pasando
    \Log::info('RoleMiddleware ejecutado', [
        'usuario_id' => Auth::id(),
        'usuario_rol' => Auth::check() ? Auth::user()->rol : 'no autenticado',
        'rol_requerido' => $role,
    ]);

    if (Auth::check() && Auth::user()->rol == $role) {
        return $next($request);
    }

    \Log::warning('Acceso denegado a ' . $request->path());
    return redirect('/');
}
```

Ver logs:
```bash
tail -f storage/logs/laravel.log
```

### Problema 2: "El middleware no se ejecuta"

**Posibles causas**:

1. **No estÃ¡ registrado en `bootstrap/app.php`**
```php
// Verificar que esto estÃ© presente:
$middleware->alias([
    'role' => \App\Http\Middleware\RoleMiddleware::class,
]);
```

2. **Error en la ruta**:
```php
// INCORRECTO (sin dos puntos)
Route::get('/panel-admin', ...)->middleware('roleadmin');

// CORRECTO
Route::get('/panel-admin', ...)->middleware('role:admin');
```

3. **CachÃ© de rutas**:
```bash
php artisan route:clear
php artisan config:clear
php artisan cache:clear
```

### Problema 3: "Inconsistencia role vs rol"

**En tu proyecto**:
- Base de datos: columna `role`
- Modelo User: `$fillable` incluye `'rol'`
- Middleware: usa `Auth::user()->rol`

**SoluciÃ³n**: Cambiar todo a `role` (lo estÃ¡ndar) o todo a `rol`:

**OpciÃ³n A: Cambiar a `role` en el modelo**:
```php
// En User.php
protected $fillable = [
    'name',
    'email',
    'password',
    'role', // Cambiar de 'rol' a 'role'
];

// En RoleMiddleware.php
if (Auth::user()->role == $role) { // Cambiar de ->rol a ->role
```

**OpciÃ³n B: Cambiar la migraciÃ³n a `rol`**:
```php
// En la migraciÃ³n
$table->string('rol')->default('user'); // Cambiar de 'role' a 'rol'
```

---

## â“ Preguntas Frecuentes

### 1. Â¿CÃ³mo agregar mÃ¡s roles (ej: moderador, editor)?

**Paso 1**: Actualizar el middleware para aceptar mÃºltiples roles:

```php
public function handle(Request $request, Closure $next, ...$roles): Response
{
    if (Auth::check() && in_array(Auth::user()->rol, $roles)) {
        return $next($request);
    }

    return redirect('/');
}
```

**Paso 2**: Usar en las rutas:

```php
// Solo admin
Route::get('/panel-admin', ...)->middleware('role:admin');

// Admin O moderador
Route::get('/moderar', ...)->middleware('role:admin,moderador');
```

### 2. Â¿CÃ³mo crear un sistema de permisos mÃ¡s complejo?

Para sistemas empresariales, usa paquetes como:

- **Spatie Permission**: https://github.com/spatie/laravel-permission
- **Bouncer**: https://github.com/JosephSilber/bouncer

Ejemplo con Spatie:
```bash
composer require spatie/laravel-permission
php artisan vendor:publish --provider="Spatie\Permission\PermissionServiceProvider"
php artisan migrate
```

```php
// Crear roles y permisos
$role = Role::create(['name' => 'admin']);
$permission = Permission::create(['name' => 'edit articles']);
$role->givePermissionTo($permission);

// Asignar rol a usuario
$user->assignRole('admin');

// Verificar permisos
if ($user->hasPermissionTo('edit articles')) {
    // Puede editar
}

// En Blade
@can('edit articles')
    <button>Editar</button>
@endcan

// En rutas
Route::get('/articulos/editar', ...)->middleware('permission:edit articles');
```

### 3. Â¿CÃ³mo proteger rutas solo para usuarios autenticados?

```php
// OpciÃ³n 1: Middleware en la ruta
Route::get('/perfil', function () {
    return view('perfil');
})->middleware('auth');

// OpciÃ³n 2: Grupo de rutas
Route::middleware(['auth'])->group(function () {
    Route::get('/perfil', ...);
    Route::get('/configuracion', ...);
    Route::get('/mensajes', ...);
});

// OpciÃ³n 3: En el controlador
class PerfilController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth');
    }
}
```

### 4. Â¿CÃ³mo hacer logout?

```blade
<!-- En cualquier vista -->
<form method="POST" action="{{ route('logout') }}">
    @csrf
    <button type="submit">Cerrar SesiÃ³n</button>
</form>
```

### 5. Â¿CÃ³mo cambiar la redirecciÃ³n despuÃ©s del login?

**OpciÃ³n 1**: En `LoginController`:
```php
protected $redirectTo = '/panel-admin'; // En vez de '/home'
```

**OpciÃ³n 2**: RedirecciÃ³n dinÃ¡mica segÃºn el rol:
```php
// En LoginController
protected function redirectTo()
{
    if (auth()->user()->rol == 'admin') {
        return '/panel-admin';
    }
    return '/home';
}
```

### 6. Â¿CÃ³mo acceder al usuario actual en cualquier parte?

```php
// En controladores
$user = Auth::user();
$user_id = Auth::id();
$nombre = Auth::user()->name;
$rol = Auth::user()->rol;

// En vistas Blade
{{ Auth::user()->name }}
{{ Auth::user()->email }}

@if(Auth::check())
    <p>EstÃ¡s logueado</p>
@endif
```

### 7. Â¿CÃ³mo verificar si un email existe antes de registrarse?

Laravel lo hace automÃ¡ticamente con:
```php
'email' => ['required', 'string', 'email', 'max:255', 'unique:users'],
```

Si el email ya existe, muestra un error automÃ¡ticamente.

### 8. Â¿CÃ³mo cambiar la contraseÃ±a de un usuario?

```php
use Illuminate\Support\Facades\Hash;

$user = User::find(1);
$user->password = Hash::make('nuevaContraseÃ±a123');
$user->save();
```

### 9. Â¿CÃ³mo mostrar errores de validaciÃ³n en la vista?

```blade
@if ($errors->any())
    <div class="alert alert-danger">
        <ul>
            @foreach ($errors->all() as $error)
                <li>{{ $error }}</li>
            @endforeach
        </ul>
    </div>
@endif

<!-- Mostrar error especÃ­fico de un campo -->
@error('email')
    <span class="error">{{ $message }}</span>
@enderror
```

---

## ğŸ“ Resumen Final: Lo que DEBES saber para un examen

### Conceptos Clave

1. **MVC**:
   - **Modelo**: Representa datos (User.php â†’ tabla users)
   - **Vista**: Lo que ve el usuario (archivos .blade.php)
   - **Controlador**: LÃ³gica de negocio (RegisterController, LoginController)

2. **Migraciones**:
   - Archivos que crean/modifican tablas de la base de datos
   - Se ejecutan con `php artisan migrate`
   - Cada migraciÃ³n tiene `up()` (crear) y `down()` (revertir)

3. **AutenticaciÃ³n**:
   - **Registro**: `RegisterController` â†’ crea usuario â†’ inicia sesiÃ³n
   - **Login**: `LoginController` â†’ verifica credenciales â†’ crea sesiÃ³n
   - **SesiÃ³n**: Cookie en navegador + registro en tabla `sessions`
   - **Auth::check()**: Verifica si hay usuario logueado
   - **Auth::user()**: Obtiene el usuario actual

4. **Middleware**:
   - Filtro que se ejecuta ANTES del controlador
   - `auth`: Verifica que el usuario estÃ© logueado
   - `role:admin`: Verifica que el usuario tenga rol admin
   - `guest`: Solo permite usuarios NO logueados

5. **Rutas**:
   - Se definen en `routes/web.php`
   - `Route::get('/url', ...)`: PeticiÃ³n GET
   - `Route::post('/url', ...)`: PeticiÃ³n POST
   - `->middleware('auth')`: Aplica middleware

6. **Blade**:
   - Motor de plantillas de Laravel
   - `@extends('layout')`: Hereda de un layout
   - `@section('content')`: Define una secciÃ³n
   - `@yield('content')`: Muestra una secciÃ³n
   - `{{ $variable }}`: Imprime variable (seguro)
   - `@if`, `@foreach`, `@auth`, `@guest`: Directivas de control

### Flujo Completo en 10 Pasos

1. Usuario visita `/register` â†’ Ve formulario
2. Usuario llena formulario â†’ EnvÃ­a POST `/register`
3. Laravel valida datos â†’ Si es vÃ¡lido, continÃºa
4. Laravel crea usuario en BD â†’ Con rol 'user' por defecto
5. Laravel crea sesiÃ³n â†’ Usuario queda logueado
6. Usuario visita `/panel-admin`
7. Laravel verifica middleware `role:admin`
8. Middleware comprueba `Auth::user()->rol == 'admin'`
9. Si es admin â†’ Muestra vista `panel-admin.blade.php`
10. Si NO es admin â†’ Redirige a `/`

### Comandos Importantes

```bash
# Crear migraciÃ³n
php artisan make:migration add_role_to_users_table

# Ejecutar migraciones
php artisan migrate

# Revertir Ãºltima migraciÃ³n
php artisan migrate:rollback

# Crear middleware
php artisan make:middleware RoleMiddleware

# Limpiar cachÃ©
php artisan cache:clear
php artisan config:clear
php artisan route:clear

# Ver rutas
php artisan route:list

# Abrir consola interactiva
php artisan tinker

# Iniciar servidor
php artisan serve
```

---

## ğŸ‰ ConclusiÃ³n

Ahora entiendes:

âœ… CÃ³mo Laravel maneja la autenticaciÃ³n
âœ… CÃ³mo funcionan las sesiones
âœ… CÃ³mo crear y usar middleware
âœ… CÃ³mo implementar un sistema de roles
âœ… El flujo completo de una peticiÃ³n HTTP en Laravel
âœ… CÃ³mo debuggear problemas comunes

**Â¡EstÃ¡s listo para aprobar cualquier prueba tÃ©cnica sobre este tema!** ğŸš€

---

**Ãšltima actualizaciÃ³n**: 4 de diciembre de 2025
**Autor**: DocumentaciÃ³n creada para proyecto auth-proyect
**VersiÃ³n de Laravel**: 12.41.1
